# Prerequisites:

- Access to an AWS account
- An S3 bucket in the account, read/write permissions to the bucket
- Store 2 files in the S3 bucket, called key_AS.txt and key_DS.txt, each one of them contains 32 binary bytes generated by [openssl RAND_bytes()](https://www.openssl.org/docs/man1.1.1/man3/RAND_bytes.html).
- Launch 3 EC2 instances in the same subnet (or any other type of virtual machines with IP connectivity)  with Docker installed on each one of them. We will call them DataOwner, DestinationServer and AuxiliaryServer. You need ssh access to the instances.

#Building the Docker image:

- Make manual changes to the code:
  - In Server_Protocol.h, update the S3 bucket name to the name of your bucket (line 16), and if necessary the AWS region (line 17)
  - In DestinationServer/main.cpp, line 268, change the ip address in the URL to the address of the AuxiliaryServer instance
- Build the image using the provided Dockerfile and store it in a repository accessible from the EC2 instances, then ssh into each instance and pull the image.
- Alternatively, zip and copy the code to each instance, unzip and build the image locally on each one of them

#Run the containers:

##On DataOwner instance:

- Make sure your AWS credentials for accessing the S3 bucket (access key and secret key) are stored in ~/.aws/credentials
- In your shell run the command:
 ```PowerShell
docker run  -v ~/.aws:/root/.aws -it <your docker image name>
```
- Now you will get a shell inside the container. Decide how many data points you want to store, e.g. 4096, and run this command inside the container shell:
```PowerShell
./Data_Owner 4096
```
- Wait for the command to finish successfully. Your AES encrypted data is now stored in S3

##On AuxiliaryServer instance:

- Make sure your AWS credentials for accessing the S3 bucket (access key and secret key) are stored in ~/.aws/credentials
- In your shell run the command:
```PowerShell
docker run  -p 8080:8080 -v ~/.aws:/root/.aws -it <your docker image name>
```
- Now you will get a shell inside the container. run this command inside the container shell:
```PowerShell
 ./Auxiliary_Server --read_keys_from_s3 4096
```
- You will see that the process is listening on port 8080

##On DestinationServer instance:

- Make sure your AWS credentials for accessing the S3 bucket (access key and secret key) are stored in ~/.aws/credentials
- In your shell run the command:
```PowerShell
docker run -v ~/.aws:/root/.aws -it <your docker image name>
```
- Now you will get a shell inside the container. run this command inside the container shell:
```PowerShell
./Destination_Server --gen_keys 4096
```
- You will now see that DestinationServer and AuxiliaryServer are communicating. The last line in the output of DestinationServer should be ‘1’ if everything is successful. You can see the measurements in /tmp/out on the container



